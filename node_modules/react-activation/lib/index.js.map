{"version":3,"file":"index.js","sources":["../src/helpers/is/index.js","../src/core/context.js","../src/core/Bridge/Context.js","../src/core/Bridge/Suspense.js","../src/core/Bridge/ErrorBoundary.js","../src/core/Bridge/index.js","../src/core/lifecycles.js","../src/core/Keeper.js","../src/core/AliveScope.js","../src/core/withAliveScope.js","../src/helpers/saveScrollPosition.js","../src/core/KeepAlive.js"],"sourcesContent":["// 值类型判断 +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++\nexport const isRegExp = (val) => val instanceof RegExp\n// 值类型判断 -------------------------------------------------------------\n","import createContext from 'create-react-context'\n\n// 整个 KeepAlive 功能的上下文，将 KeepAlive 的组件藏于其 Provider 中，保证其不会被卸载\nexport const aliveScopeContext = createContext()\nexport const {\n  Provider: AliveScopeProvider,\n  Consumer: AliveScopeConsumer,\n} = aliveScopeContext\n\n// KeepAlive 组件的上下文，实现缓存生命周期功能\nexport const aliveNodeContext = createContext()\nexport const {\n  Provider: AliveNodeProvider,\n  Consumer: AliveNodeConsumer,\n} = aliveNodeContext\n","/**\n * 本文件用于修复 KeepAlive 转移 children 后的自定义上下文丢失问题\n * 问题及方案最初的探讨可参考以下\n * https://github.com/StructureBuilder/react-keep-alive/issues/36\n */\nimport React, { PureComponent, useContext, useRef, useEffect } from 'react'\nimport createReactContext from 'create-react-context'\nimport { run, get, nextTick, isUndefined, isFunction } from 'szfe-tools'\n\nconst fixedContext = []\nconst updateListenerCache = new Map()\n\nexport function fixContext(ctx) {\n  fixedContext.push(ctx)\n}\n\nexport const createContext = (...args) => {\n  const ctx = createReactContext(...args)\n\n  fixContext(ctx)\n  return ctx\n}\n\n// 递归重建上下文 Provider\nexport class ProviderBridge extends PureComponent {\n  unmount = null\n  constructor(props, ...args) {\n    super(props, ...args)\n\n    const { value: ctxValues } = props\n\n    if (ctxValues.length === 0) {\n      this.state = {\n        ctxValue: null,\n      }\n\n      return\n    }\n\n    const [{ ctx, value, onUpdate }] = ctxValues\n\n    this.state = {\n      ctxValue: value,\n    }\n\n    this.unmount = onUpdate((value) => {\n      this.setState({\n        ctxValue: value,\n      })\n    })\n  }\n\n  componentWillUnmount() {\n    run(this.unmount)\n  }\n\n  // componentDidCatch(error) {\n  //   console.error('ProviderBridge Error', error)\n  // }\n\n  render() {\n    const { value: ctxValues, children } = this.props\n\n    if (ctxValues.length === 0) {\n      return children\n    }\n\n    const { ctxValue } = this.state\n    const [{ ctx }, ...restValues] = ctxValues\n    const { Provider } = ctx\n\n    const nextChildren = !isUndefined(ctxValue) ? (\n      <Provider value={ctxValue}>{children}</Provider>\n    ) : (\n      children\n    )\n\n    // 递归 ProviderBridge 修复多个上下文\n    // 此处未考虑待修复上下文顺序问题，按先来后到顺序处理，但理论上不应存在顺序问题\n    return restValues.length > 0 ? (\n      <ProviderBridge value={restValues}>{nextChildren}</ProviderBridge>\n    ) : (\n      nextChildren\n    )\n  }\n}\n\n// 在 KeepAlive 位置使用待修复上下文的 Consumer 探测可能存在的上下文关系\n// 若成功捕获上下文则保存其内容，用以后续 Keeper 中上下文的重建\nclass ConsumerWrapper extends PureComponent {\n  updateListener = null\n  ctxInfo = null\n  constructor(props, ...args) {\n    super(props, ...args)\n\n    const { value, ctx, id } = props\n    if (isUndefined(value)) {\n      return\n    }\n\n    // 因 Consumer 探测器存在于 KeepAlive 外层故会随着 KeepAlive 卸载\n    // componentWillUnmount 中保留了已生成的更新监听器\n    // 此处重新挂载后恢复与对应 Keeper 中 ProviderBridge 的联系\n    this.updateListener = get(updateListenerCache.get(ctx), id, new Map())\n    this.ctxInfo = {\n      ctx,\n      value,\n      // 注册上下文更新的监听，保证上下文更新时 Keeper 中 ProviderBridge 内容的同步\n      onUpdate: (updator) => {\n        this.updateListener.set(updator, updator)\n\n        // 返回更新监听器的注销方法\n        return () => this.updateListener.delete(updator)\n      },\n    }\n  }\n\n  componentWillUnmount() {\n    const { value, ctx, id } = this.props\n    if (isUndefined(value)) {\n      return\n    }\n\n    // 因 Consumer 探测器存在于 KeepAlive 外层故会随着 KeepAlive 卸载\n    // 此处保留其中已生成的更新监听器，用以在重新挂载后保持与对应 Keeper 中 ProviderBridge 的联系\n    updateListenerCache.set(ctx, {\n      ...get(updateListenerCache.get(ctx), undefined, {}),\n      [id]: this.updateListener,\n    })\n  }\n\n  // 利用 shouldComponentUpdate 尽早将上下文更新的咨询通知到对应 Keeper 中 ProviderBridge\n  // TODO: 改用 componentWillReceiveProps 更早地进行更新，需注意与 getDerivedStateFromProps 新生命周期的兼容及可能存在的死循环问题\n  shouldComponentUpdate({ value }) {\n    const { prevValue } = this.props\n    const shouldUpdate = prevValue !== value\n\n    if (shouldUpdate) {\n      run(this.updateListener, 'forEach', (fn) => fn(value))\n    }\n\n    return shouldUpdate\n  }\n\n  render() {\n    const { value, renderWrapper, renderContent, id } = this.props\n\n    return renderWrapper((ctx$$) =>\n      renderContent(isUndefined(value) ? ctx$$ : [...ctx$$, this.ctxInfo])\n    )\n  }\n}\n\n// 对 ConsumerWrapper 的递归结构，会在 devtool 中生成较深的嵌套结构，可用 hooks 消除嵌套结构\nfunction RecursiveConsumerBridge({ children: renderChildren, id }) {\n  const renderWrapper = fixedContext.reduce(\n    (render, ctx) => {\n      const { Consumer } = ctx\n\n      const renderWrapper = (renderContent) => (\n        <Consumer>\n          {(value) => (\n            <ConsumerWrapper\n              {...{\n                value,\n                ctx,\n                renderWrapper: render,\n                renderContent,\n                id,\n              }}\n            />\n          )}\n        </Consumer>\n      )\n\n      return renderWrapper\n    },\n    (renderContent) => renderContent([])\n  )\n\n  return renderWrapper(renderChildren)\n}\n\n// 若支持 Hooks，就不需要递归了，相关实现解释可参考 ConsumerWrapper\nfunction HooksConsumerBridge({ children: renderChildren, id }) {\n  const context$$ = fixedContext\n    .map((ctx) => {\n      const value = useContext(ctx)\n      const prevValueRef = useRef(value)\n      const { current: updateListener } = useRef(\n        get(updateListenerCache.get(ctx), id, new Map())\n      )\n\n      // 尽可能早地进行更新\n      if (prevValueRef.current !== value) {\n        nextTick(() => run(updateListener, 'forEach', (fn) => fn(value)))\n      }\n      prevValueRef.current = value\n\n      useEffect(() => {\n        return () => {\n          if (isUndefined(value)) {\n            return\n          }\n\n          updateListenerCache.set(ctx, {\n            ...get(updateListenerCache.get(ctx), undefined, {}),\n            [id]: updateListener,\n          })\n        }\n      }, [])\n\n      return {\n        ctx,\n        value,\n        onUpdate: (fn) => {\n          updateListener.set(fn, fn)\n\n          return () => updateListener.delete(fn)\n        },\n      }\n    })\n    .filter(({ value }) => !isUndefined(value))\n\n  return renderChildren(context$$)\n}\n\nexport const ConsumerBridge = [useContext, useRef, useEffect].every(isFunction)\n  ? HooksConsumerBridge\n  : RecursiveConsumerBridge\n","import React, { lazy, Suspense, Component, Fragment } from 'react'\nimport { run, isUndefined, isFunction } from 'szfe-tools'\n\n// 兼容性检测\nconst isSupported = isFunction(lazy) && !isUndefined(Suspense)\nconst SusNotSupported = ({ children }) => run(children)\n\nconst Lazy = isSupported ? lazy(() => new Promise(() => null)) : () => null\n\nclass FallbackListener extends Component {\n  componentDidMount() {\n    run(this.props, 'onStart')\n  }\n\n  componentWillUnmount() {\n    run(this.props, 'onEnd')\n  }\n\n  render() {\n    return null\n  }\n}\n\nfunction SuspenseBridge({ children, sus$$ }) {\n  return (\n    // 捕获 Keeper 内部可能存在的 lazy，并触发对应 KeepAlive 位置上的 LazyBridge\n    <Suspense\n      fallback={\n        <FallbackListener\n          onStart={sus$$.onSuspenseStart}\n          onEnd={sus$$.onSuspenseEnd}\n        />\n      }\n    >\n      {children}\n    </Suspense>\n  )\n}\n\nexport const LazyBridge = isSupported\n  ? class LazyBridge extends Component {\n      state = {\n        suspense: false,\n      }\n\n      onSuspenseStart = () => {\n        this.setState({\n          suspense: true,\n        })\n      }\n\n      onSuspenseEnd = () => {\n        this.setState({\n          suspense: false,\n        })\n      }\n\n      sus$$ = {\n        onSuspenseStart: this.onSuspenseStart,\n        onSuspenseEnd: this.onSuspenseEnd,\n      }\n\n      render() {\n        const { children } = this.props\n\n        return (\n          <Fragment>\n            {run(children, undefined, this.sus$$)}\n            {/* 渲染 Lazy 以触发 KeepAlive 所处位置外部可能存在的 Suspense */}\n            {this.state.suspense && <Lazy />}\n          </Fragment>\n        )\n      }\n    }\n  : SusNotSupported\n\nexport default isSupported ? SuspenseBridge : SusNotSupported\n","import { Component } from 'react'\nimport { run } from 'szfe-tools'\n\nexport default class ErrorBoundaryBridge extends Component {\n  // Error Boundary 透传至对应 KeepAlive 实例位置\n  static getDerivedStateFromError = () => null\n  componentDidCatch(error) {\n    const { error$$: throwError } = this.props\n\n    run(throwError, undefined, error, () => {\n      run(throwError, undefined, null)\n    })\n  }\n\n  render() {\n    return this.props.children\n  }\n}\n\nexport class ErrorThrower extends Component {\n  state = {\n    error: null,\n  }\n\n  throwError = (error, cb) => this.setState({ error }, cb)\n  render() {\n    if (this.state.error) {\n      throw this.state.error\n    }\n\n    return run(this.props.children, undefined, this.throwError)\n  }\n}\n","import React from 'react'\nimport { run } from 'szfe-tools'\n\nimport { ProviderBridge, ConsumerBridge } from './Context'\nimport SuspenseBridge, { LazyBridge } from './Suspense'\nimport ErrorBoundaryBridge, { ErrorThrower } from './ErrorBoundary'\n\n// 用于 Keeper 中，实现 Keeper 向外或向内的桥接代理\nexport default function Bridge({ id, children, bridgeProps }) {\n  const { sus$$, ctx$$, error$$ } = bridgeProps\n\n  return (\n    /* 由内向外透传 componentDidCatch 捕获的 error */\n    <ErrorBoundaryBridge error$$={error$$}>\n      {/* 由内向外透传 lazy 行为 */}\n      <SuspenseBridge sus$$={sus$$}>\n        {/* 由外向内透传可能存在的 Consumer 数据 */}\n        <ProviderBridge id={id} value={ctx$$}>\n          {children}\n        </ProviderBridge>\n      </SuspenseBridge>\n    </ErrorBoundaryBridge>\n  )\n}\n\n// 用于 KeepAlive 中，实现 KeepAlive 向外或向内的桥接代理\nexport function Acceptor({ id, children }) {\n  return (\n    /* 由内向外透传 componentDidCatch 捕获的 error */\n    <ErrorThrower>\n      {(error$$) => (\n        /* 由内向外透传 lazy 行为 */\n        <LazyBridge>\n          {(sus$$) => (\n            /* 由外向内透传可能被捕获的 Provider 数据 */\n            <ConsumerBridge id={id}>\n              {(ctx$$) =>\n                run(children, undefined, {\n                  bridgeProps: {\n                    sus$$,\n                    ctx$$,\n                    error$$,\n                  },\n                })\n              }\n            </ConsumerBridge>\n          )}\n        </LazyBridge>\n      )}\n    </ErrorThrower>\n  )\n}\n","import React, {\n  Component,\n  forwardRef,\n  useEffect,\n  useRef,\n  useContext,\n} from 'react'\nimport hoistStatics from 'hoist-non-react-statics'\nimport {\n  get,\n  run,\n  nextTick,\n  isObject,\n  isFunction,\n  isUndefined,\n} from 'szfe-tools'\n\nimport { AliveNodeConsumer, aliveNodeContext } from './context'\n\nexport const LIFECYCLE_ACTIVATE = 'componentDidActivate'\nexport const LIFECYCLE_UNACTIVATE = 'componentWillUnactivate'\n\nexport const withActivation = (WrappedComponent) => {\n  class HOC extends Component {\n    drop = null\n\n    componentWillUnmount() {\n      run(this.drop)\n    }\n\n    render() {\n      const { forwardedRef, ...props } = this.props\n\n      return (\n        <AliveNodeConsumer>\n          {({ attach } = {}) => (\n            <WrappedComponent\n              ref={(ref) => {\n                if (\n                  [LIFECYCLE_ACTIVATE, LIFECYCLE_UNACTIVATE].every(\n                    (lifecycleName) => !isFunction(get(ref, lifecycleName))\n                  )\n                ) {\n                  return\n                }\n                this.drop = run(attach, undefined, ref)\n\n                // 以下保持 ref 功能\n                if (isUndefined(forwardedRef)) {\n                  return\n                }\n\n                if (isObject(forwardedRef) && 'current' in forwardedRef) {\n                  forwardedRef.current = ref\n                  return\n                }\n\n                run(forwardedRef, undefined, ref)\n              }}\n              {...props}\n            />\n          )}\n        </AliveNodeConsumer>\n      )\n    }\n  }\n\n  // 由于 KeepAlive 内组件渲染与实际内容落后一个节拍\n  // 将导致真实节点的 componentDidMount 无法及时获取到 KeepAlive 中内容的 ref 值\n  // 此处对使用了 withActivation HOC 的组件 componentDidMount 做 nextTick 延时处理\n  // 修复上述问题\n\n  if (isFunction(WrappedComponent.prototype.componentDidMount)) {\n    WrappedComponent.prototype._componentDidMount =\n      WrappedComponent.prototype.componentDidMount\n    WrappedComponent.prototype.componentDidMount = function componentDidMount() {\n      nextTick(() => WrappedComponent.prototype._componentDidMount.call(this))\n    }\n  }\n\n  if (isFunction(forwardRef)) {\n    const ForwardedRefHOC = forwardRef((props, ref) => (\n      <HOC {...props} forwardedRef={ref} />\n    ))\n\n    return hoistStatics(ForwardedRefHOC, WrappedComponent)\n  } else {\n    return hoistStatics(HOC, WrappedComponent)\n  }\n}\n\nconst useActivation = (funcName, func) => {\n  // 兼容性判断\n  if ([useRef, useContext, useEffect].some((fn) => !isFunction(fn))) {\n    return\n  }\n\n  const ctxValue = useContext(aliveNodeContext)\n\n  // 未处于 KeepAlive 中\n  if (!ctxValue) {\n    return\n  }\n\n  const { current: ref } = useRef({})\n  const { attach } = ctxValue\n\n  ref[funcName] = func\n  ref.drop = attach(ref)\n\n  useEffect(() => {\n    return () => run(ref.drop)\n  }, [])\n}\n\nexport const useActivate = useActivation.bind(null, LIFECYCLE_ACTIVATE)\nexport const useUnactivate = useActivation.bind(null, LIFECYCLE_UNACTIVATE)\n","import React, { PureComponent } from 'react'\nimport { get, run, nextTick } from 'szfe-tools'\n\nimport Bridge from './Bridge'\nimport { AliveNodeProvider } from './context'\nimport { LIFECYCLE_ACTIVATE, LIFECYCLE_UNACTIVATE } from './lifecycles'\n\nexport default class Keeper extends PureComponent {\n  listeners = new Map()\n  wrapper = null\n\n  constructor(props, ...rest) {\n    super(props, ...rest)\n\n    this.state = {\n      children: props.children,\n      bridgeProps: props.bridgeProps,\n      key: Math.random(),\n    }\n  }\n\n  componentDidMount() {\n    const { store, id } = this.props\n    const listeners = this.listeners\n    const node = this.wrapper\n\n    // 已存在检测，防止意外现象\n    if (store.has(id)) {\n      return\n    }\n\n    store.set(id, {\n      listeners,\n      aliveNodesId: [],\n      inited: false,\n      cached: false,\n      wrapper: node,\n      nodes: [...node.children],\n      [LIFECYCLE_ACTIVATE]: () => this[LIFECYCLE_ACTIVATE](),\n      [LIFECYCLE_UNACTIVATE]: () => this[LIFECYCLE_UNACTIVATE](),\n    })\n  }\n\n  componentWillUnmount() {\n    const { store, keepers, id } = this.props\n    // 卸载前尝试归位 DOM 节点\n    try {\n      const cache = store.get(id)\n      cache.nodes.forEach((node) => {\n        cache.wrapper.appendChild(node)\n      })\n    } catch (error) {\n      // console.error(error) // do nothing\n    }\n    store.delete(id)\n    keepers.delete(id)\n  }\n\n  [LIFECYCLE_ACTIVATE]() {\n    this.listeners.forEach((listener) => run(listener, [LIFECYCLE_ACTIVATE]))\n  }\n\n  [LIFECYCLE_UNACTIVATE]() {\n    const listeners = [...this.listeners]\n\n    listeners\n      .reverse()\n      .forEach(([, listener]) => run(listener, [LIFECYCLE_UNACTIVATE]))\n  }\n\n  // // 原先打算更新过程中先重置 dom 节点状态，更新后恢复 dom 节点\n  // // 但考虑到性能消耗可能过大，且可能因 dom 操作时机引发其他 react 渲染问题，故不使用\n  // // 对应 KeepAlive 处 update 也注释起来不使用\n  // // 组件更新后，更新 DOM 节点列表状态\n  // componentDidUpdate() {\n  //   const { store, id } = this.props\n  //   const node = this.wrapper\n  //   if (get(node, 'children.length') > 0) {\n  //     store[id].nodes = [...node.children]\n  //   }\n\n  //   console.log(store[id].nodes)\n  // }\n\n  // 生命周期绑定\n  attach = (ref) => {\n    const listeners = this.listeners\n\n    if (!ref) {\n      return () => null\n    }\n\n    if (ref.isKeepAlive) {\n      nextTick(() => {\n        const { id, store } = this.props\n        const cache = store.get(id)\n        cache.aliveNodesId = new Set([...cache.aliveNodesId, ref.id])\n      })\n    }\n\n    listeners.set(ref, {\n      [LIFECYCLE_ACTIVATE]: () => run(ref, LIFECYCLE_ACTIVATE),\n      [LIFECYCLE_UNACTIVATE]: () => run(ref, LIFECYCLE_UNACTIVATE),\n    })\n\n    // 返回 listenerRemover 用以在对应组件卸载时解除监听\n    return () => {\n      listeners.delete(ref)\n    }\n  }\n\n  // 静态化节点上下文内容，防止重复渲染\n  contextValue = {\n    id: this.props.id,\n    attach: this.attach,\n  }\n\n  refresh = (cb) =>\n    this.setState(\n      {\n        key: Math.random(),\n      },\n      cb\n    )\n\n  render() {\n    const { id, ...props } = this.props\n    const { children, bridgeProps, key } = this.state\n\n    return (\n      <div\n        ref={(node) => {\n          this.wrapper = node\n        }}\n      >\n        <div key=\"keeper-container\" nodeKeyIgnore className=\"ka-content\">\n          <Bridge id={id} bridgeProps={bridgeProps}>\n            <AliveNodeProvider value={this.contextValue}>\n              {React.cloneElement(children, {\n                key: `${children.key}:${key}`,\n              })}\n            </AliveNodeProvider>\n          </Bridge>\n        </div>\n      </div>\n    )\n  }\n}\n","import React, { Component } from 'react'\nimport { get, flatten } from 'szfe-tools'\n\nimport { isRegExp } from '../helpers/is'\nimport { AliveScopeProvider } from './context'\nimport Keeper from './Keeper'\n\nconst HANDLE_TYPE_DROP = 'drop'\nconst HANDLE_TYPE_REFRESH = 'refresh'\n\nexport default class AliveScope extends Component {\n  store = new Map()\n  nodes = new Map()\n  keepers = new Map()\n\n  update = (id, params) =>\n    new Promise((resolve) => {\n      const keeper = this.keepers.get(id)\n      const isNew = !keeper\n      const now = Date.now()\n      const node = this.nodes.get(id) || null\n      this.nodes.set(id, {\n        id,\n        createTime: now,\n        updateTime: now,\n        ...node,\n        ...params,\n      })\n\n      if (isNew) {\n        this.helpers = { ...this.helpers }\n\n        this.forceUpdate(resolve)\n      } else {\n        const { children, bridgeProps } = params\n        keeper.setState({ children, bridgeProps }, resolve)\n      }\n    })\n\n  keep = (id, params) =>\n    new Promise((resolve) => {\n      this.update(id, {\n        id,\n        ...params,\n      }).then(() => {\n        resolve(this.store.get(id))\n      })\n    })\n\n  getCachingNodesByName = (name) =>\n    this.getCachingNodes().filter((node) =>\n      isRegExp(name) ? name.test(node.name) : node.name === name\n    )\n\n  getScopeIds = (ids) => {\n    // 递归采集 scope alive nodes id\n    const getCachingNodesId = (id) => {\n      const aliveNodesId = get(this.getCache(id), 'aliveNodesId', [])\n\n      if (aliveNodesId.size > 0) {\n        return [id, [...aliveNodesId].map(getCachingNodesId)]\n      }\n\n      return [id, ...aliveNodesId]\n    }\n\n    return flatten(ids.map((id) => getCachingNodesId(id)))\n  }\n\n  dropById = (id) => this.handleNodes([id], HANDLE_TYPE_DROP)\n  dropScopeByIds = (ids) =>\n    this.handleNodes(this.getScopeIds(ids), HANDLE_TYPE_DROP)\n\n  drop = (name) =>\n    this.handleNodes(\n      this.getCachingNodesByName(name).map((node) => node.id),\n      HANDLE_TYPE_DROP\n    )\n\n  dropScope = (name) =>\n    this.dropScopeByIds(this.getCachingNodesByName(name).map(({ id }) => id))\n\n  refreshById = (id) => this.handleNodes([id], HANDLE_TYPE_REFRESH)\n  refreshScopeByIds = (ids) =>\n    this.handleNodes(this.getScopeIds(ids), HANDLE_TYPE_REFRESH)\n\n  refresh = (name) =>\n    this.handleNodes(\n      this.getCachingNodesByName(name).map((node) => node.id),\n      HANDLE_TYPE_REFRESH\n    )\n\n  refreshScope = (name) =>\n    this.refreshScopeByIds(this.getCachingNodesByName(name).map(({ id }) => id))\n\n  handleNodes = (nodesId, type = HANDLE_TYPE_DROP) =>\n    new Promise((resolve) => {\n      const willRefreshKeepers = []\n      const willDropNodes = []\n\n      nodesId.forEach((id) => {\n        const cache = this.store.get(id)\n\n        if (!cache) {\n          return\n        }\n\n        const canRefresh = type === HANDLE_TYPE_REFRESH && !get(cache, 'cached')\n        const canDrop =\n          (type === HANDLE_TYPE_DROP && get(cache, 'cached')) ||\n          get(cache, 'willDrop')\n\n        if (canDrop) {\n          // 用在多层 KeepAlive 同时触发 drop 时，避免触发深层 KeepAlive 节点的缓存生命周期\n          cache.willDrop = true\n          this.nodes.delete(id)\n          willDropNodes.push(id)\n        }\n\n        if (canRefresh) {\n          const keeper = this.keepers.get(id)\n          willRefreshKeepers.push(keeper)\n        }\n      })\n\n      Promise.all([\n        willDropNodes.length === 0\n          ? Promise.resolve(false)\n          : new Promise((resolve) => {\n              this.helpers = { ...this.helpers }\n              this.forceUpdate(() => resolve(true))\n            }),\n        willRefreshKeepers.length === 0\n          ? Promise.resolve(false)\n          : Promise.all(\n              willRefreshKeepers.map(\n                (keeper) => new Promise((resolve) => keeper.refresh(resolve))\n              )\n            ),\n      ]).then(([dropSuccessfully, refreshSuccessfully]) =>\n        resolve(Boolean(dropSuccessfully || refreshSuccessfully))\n      )\n    })\n\n  clear = () => this.handleNodes(this.getCachingNodes().map(({ id }) => id))\n\n  getCache = (id) => this.store.get(id)\n  getNode = (id) => this.nodes.get(id)\n  getCachingNodes = () => [...this.nodes.values()]\n\n  // 静态化节点上下文内容，防止重复渲染\n  helpers = {\n    keep: this.keep,\n    update: this.update,\n    drop: this.drop,\n    dropScope: this.dropScope,\n    dropById: this.dropById,\n    dropScopeByIds: this.dropScopeByIds,\n    refresh: this.refresh,\n    refreshScope: this.refreshScope,\n    refreshById: this.refreshById,\n    refreshScopeByIds: this.refreshScopeByIds,\n    getScopeIds: this.getScopeIds,\n    clear: this.clear,\n    getCache: this.getCache,\n    getNode: this.getNode,\n    getCachingNodes: this.getCachingNodes,\n  }\n\n  render() {\n    const { children } = this.props\n\n    return (\n      <AliveScopeProvider value={this.helpers}>\n        {children}\n        <div style={{ display: 'none' }}>\n          {[...this.nodes.values()].map(({ children, ...props }) => (\n            <Keeper\n              key={props.id}\n              {...props}\n              store={this.store}\n              keepers={this.keepers}\n              ref={(keeper) => {\n                this.keepers.set(props.id, keeper)\n              }}\n            >\n              {children}\n            </Keeper>\n          ))}\n        </div>\n      </AliveScopeProvider>\n    )\n  }\n}\n","import React, { forwardRef, useContext } from 'react'\nimport hoistStatics from 'hoist-non-react-statics'\nimport { get, isFunction, isUndefined } from 'szfe-tools'\n\nimport { Acceptor } from './Bridge'\nimport NodeKey from './NodeKey'\nimport { AliveScopeConsumer, aliveScopeContext } from './context'\n\nfunction controllerCherryPick(controller) {\n  const {\n    drop,\n    dropScope,\n    refresh,\n    refreshScope,\n    clear,\n    getCachingNodes,\n  } = controller\n  return { drop, dropScope, refresh, refreshScope, clear, getCachingNodes }\n}\n\nexport const expandKeepAlive = (KeepAlive) => {\n  const renderContent = ({ idPrefix, helpers, props }) => {\n    const isOutsideAliveScope = isUndefined(helpers)\n\n    if (isOutsideAliveScope) {\n      console.error('You should not use <KeepAlive /> outside a <AliveScope>')\n    }\n\n    return isOutsideAliveScope ? (\n      get(props, 'children', null)\n    ) : (\n      <NodeKey prefix={idPrefix} key={props._nk}>\n        {(id) => (\n          <Acceptor id={id}>\n            {(bridgeProps) => (\n              <KeepAlive\n                key={id}\n                {...props}\n                {...bridgeProps}\n                id={id}\n                _helpers={helpers}\n              />\n            )}\n          </Acceptor>\n        )}\n      </NodeKey>\n    )\n  }\n  const HookExpand = ({ id: idPrefix, ...props }) =>\n    renderContent({ idPrefix, helpers: useContext(aliveScopeContext), props })\n\n  const WithExpand = ({ id: idPrefix, ...props }) => (\n    <AliveScopeConsumer>\n      {(helpers) => renderContent({ idPrefix, helpers, props })}\n    </AliveScopeConsumer>\n  )\n\n  return isFunction(useContext) ? HookExpand : WithExpand\n}\n\nconst withAliveScope = (WrappedComponent) => {\n  const renderContent = ({ helpers, props, forwardedRef }) => (\n    <WrappedComponent {...props} {...helpers} ref={forwardedRef} />\n  )\n\n  const HookScope = ({ forwardedRef, ...props }) =>\n    renderContent({\n      helpers: controllerCherryPick(useContext(aliveScopeContext) || {}),\n      props,\n      forwardedRef,\n    })\n\n  const WithScope = ({ forwardedRef, ...props }) => (\n    <AliveScopeConsumer>\n      {(controller = {}) =>\n        renderContent({\n          helpers: controllerCherryPick(controller),\n          props,\n          forwardedRef,\n        })\n      }\n    </AliveScopeConsumer>\n  )\n\n  const HOCWithAliveScope = isFunction(useContext) ? HookScope : WithScope\n\n  if (isFunction(forwardRef)) {\n    const ForwardedRefHOC = forwardRef((props, ref) => (\n      <HOCWithAliveScope {...props} forwardedRef={ref} />\n    ))\n\n    return hoistStatics(ForwardedRefHOC, WrappedComponent)\n  } else {\n    return hoistStatics(HOCWithAliveScope, WrappedComponent)\n  }\n}\n\nexport const useAliveController = () => {\n  if (!isFunction(useContext)) {\n    return {}\n  }\n\n  const ctxValue = useContext(aliveScopeContext)\n\n  if (!ctxValue) {\n    return {}\n  }\n\n  return controllerCherryPick(ctxValue)\n}\n\nexport default withAliveScope\n","import {\n  globalThis as root,\n  get,\n  run,\n  value,\n  isFunction,\n  isExist,\n  flatten,\n} from 'szfe-tools'\n\nfunction isScrollableNode(node = {}) {\n  if (!isExist(node)) {\n    return false\n  }\n\n  return (\n    node.scrollWidth > node.clientWidth || node.scrollHeight > node.clientHeight\n  )\n}\n\nfunction getScrollableNodes(from) {\n  if (!isFunction(get(root, 'document.querySelectorAll'))) {\n    return []\n  }\n\n  return [...value(run(from, 'querySelectorAll', '*'), []), from].filter(\n    isScrollableNode\n  )\n}\n\nexport default function saveScrollPosition(from) {\n  const nodes = [...new Set([...flatten(from.map(getScrollableNodes))])]\n\n  const saver = nodes.map((node) => [\n    node,\n    {\n      x: node.scrollLeft,\n      y: node.scrollTop,\n    },\n  ])\n\n  return function revert() {\n    saver.forEach(([node, { x, y }]) => {\n      node.scrollLeft = x\n      node.scrollTop = y\n    })\n  }\n}\n","import React, { Component } from 'react'\nimport {\n  value,\n  get,\n  run,\n  globalThis as root,\n  nextTick,\n  isFunction,\n  isArray,\n  debounce,\n  flatten,\n} from 'szfe-tools'\n\nimport { expandKeepAlive } from './withAliveScope'\nimport {\n  LIFECYCLE_ACTIVATE,\n  LIFECYCLE_UNACTIVATE,\n  withActivation,\n} from './lifecycles'\nimport saveScrollPosition from '../helpers/saveScrollPosition'\n\nconst body = get(root, 'document.body')\nconst screenScrollingElement = get(\n  root,\n  'document.scrollingElement',\n  get(root, 'document.documentElement', {})\n)\n\nconst getErrorTips = (name) =>\n  `<KeepAlive ${\n    name ? `name=\"${name}\" ` : ''\n  }/> Too many transient updates, may have encountered an infinite loop of updates, forced to pause the update\nThere are serious performance issues with the update results you are currently seeing\nMay encounter an implied bug, please don't use KeepAlive and contact the author to solve`\n\nconst parseWhenResult = (res) => {\n  if (isArray(res)) {\n    return res\n  }\n\n  return [res]\n}\n\nclass KeepAlive extends Component {\n  static defaultProps = {\n    saveScrollPosition: true,\n  }\n  // 本段为 KeepAlive 更新隐患检测，通过检测 KeepAlive 瞬时更新次数来判断是否进入死循环，并在 update 中强制阻止更新\n  updateTimes = 0\n  errorTips = debounce(() => {\n    const { name } = this.props\n    console.error(getErrorTips(name))\n  }, 100)\n  releaseUpdateTimes = debounce(() => {\n    this.updateTimes = 0\n  }, 16)\n  needForceStopUpdate = () => {\n    const needForceStopUpdate = this.updateTimes > 64\n\n    if (needForceStopUpdate) {\n      this.errorTips()\n    }\n\n    this.updateTimes++\n    this.releaseUpdateTimes()\n\n    return needForceStopUpdate\n  }\n\n  id = null // 用作 Keeper 识别 KeepAlive\n  isKeepAlive = true // 用作 Keeper 识别 KeepAlive\n  cached = false\n  constructor(props) {\n    super(props)\n    this.id = props.id\n    this.init()\n\n    // 继承响应父级 KeepAlive 的生命周期\n    ;[LIFECYCLE_ACTIVATE, LIFECYCLE_UNACTIVATE].forEach((lifecycleName) => {\n      this[lifecycleName] = () => {\n        const { id, _helpers } = this.props\n        const cache = _helpers.getCache(id)\n        const node = _helpers.getNode(id)\n        if (node && lifecycleName == LIFECYCLE_ACTIVATE) {\n          node.updateTime = Date.now()\n        }\n\n        const cached = lifecycleName === LIFECYCLE_UNACTIVATE\n\n        // 若组件即将卸载则不再触发缓存生命周期\n        if (!cache || cache.willDrop) {\n          // 若组件在父 KeepAlive 缓存期间被卸载，后续恢复后需重新触发 init\n          if (this.cached && !cached) {\n            this.init()\n          }\n          return\n        }\n\n        run(cache, lifecycleName)\n        cache.cached = cached\n        this.cached = cached\n      }\n    })\n  }\n\n  // DOM 操作将实际内容插入占位元素\n  inject = (didActivate = true) => {\n    const { id, saveScrollPosition, _helpers } = this.props\n    const cache = _helpers.getCache(id)\n    // DOM 操作有风险，try catch 护体\n    try {\n      // // 原计划不增加额外的节点，直接将 Keeper 中所有内容节点一一迁移\n      // // 后发现缺乏统一 react 认可的外层包裹，可能会造成 react dom 操作的错误\n      // // 且将导致 KeepAlive 进行 update 时需先恢复各 dom 节点的组件归属，成本过高\n      // // 故此处增加统一的 div 外层，Keeper 中与 KeepAlive 中各一个且外层不做移除处理\n      // this.parentNode = this.placeholder.parentNode\n      // cache.nodes.forEach(node => {\n      //   this.parentNode.insertBefore(node, this.placeholder)\n      // })\n      // this.parentNode.removeChild(this.placeholder)\n      // 将 AliveScopeProvider 中的渲染内容通过 dom 操作置回当前 KeepAlive\n      cache.nodes.forEach((node) => {\n        this.placeholder.appendChild(node)\n      })\n\n      if (didActivate && saveScrollPosition) {\n        // 恢复该节点下各可滚动元素的滚动位置\n        run(cache.revertScrollPos)\n      }\n    } catch (error) {\n      // console.error(error)\n    }\n  }\n\n  // DOM 操作将实际内容移出占位元素\n  eject = (willUnactivate = true) => {\n    const { id, _helpers } = this.props\n    const cache = _helpers.getCache(id)\n    const nodesNeedToSaveScrollPosition = flatten(\n      flatten([this.props.saveScrollPosition]).map((flag) => {\n        if (flag === true) {\n          return cache.nodes\n        }\n\n        if (flag === 'screen') {\n          return [screenScrollingElement, body]\n        }\n\n        return [...value(run(root, 'document.querySelectorAll', flag), [])]\n      })\n    ).filter(Boolean)\n\n    // DOM 操作有风险，try catch 护体\n    try {\n      if (willUnactivate && nodesNeedToSaveScrollPosition.length > 0) {\n        // 保存该节点下各可滚动元素的滚动位置\n        cache.revertScrollPos = saveScrollPosition(\n          nodesNeedToSaveScrollPosition\n        )\n      }\n\n      // // 原计划不增加额外的节点，直接将 Keeper 中所有内容节点一一迁移\n      // // 后发现缺乏统一 react 认可的外层包裹，可能会造成 react dom 操作的错误\n      // // 且将导致 KeepAlive 进行 update 时需先恢复各 dom 节点的组件归属，成本过高\n      // // 故此处增加统一的 div 外层，Keeper 中与 KeepAlive 中各一个且外层不做移除处理\n      // this.parentNode.insertBefore(this.placeholder, cache.nodes[0])\n      // cache.nodes.forEach(node => {\n      //   if (willUnactivate) {\n      //     this.parentNode.removeChild(node)\n      //   } else {\n      //     cache.wrapper.appendChild(node)\n      //   }\n      // })\n      // this.parentNode.insertBefore(this.placeholder, cache.nodes[0])\n      // 将 KeepAlive 中的节点恢复为原先的占位节点，保证卸载操作正常进行\n      cache.nodes.forEach((node) => {\n        if (willUnactivate) {\n          this.placeholder.removeChild(node)\n        } else {\n          cache.wrapper.appendChild(node)\n        }\n      })\n    } catch (error) {\n      // console.error(error)\n    }\n  }\n\n  init = () => {\n    const { _helpers, id, children, ...rest } = this.props\n\n    // 将 children 渲染至 AliveScopeProvider 中\n    _helpers\n      .keep(id, {\n        children,\n        getInstance: () => this,\n        ...rest,\n      })\n      .then((cache) => {\n        // fix #22\n        if (!cache) {\n          return\n        }\n\n        this.inject()\n\n        // 触发 didActivate 生命周期\n        if (cache.inited) {\n          run(this, LIFECYCLE_ACTIVATE)\n        } else {\n          cache.inited = true\n        }\n        this.cached = false\n      })\n  }\n\n  update = ({ _helpers, id, name, ...rest } = {}) => {\n    if (!_helpers || this.cached || this.needForceStopUpdate(name)) {\n      return\n    }\n\n    // // 原先打算更新过程中先重置 dom 节点状态，更新后恢复 dom 节点\n    // // 但考虑到性能消耗可能过大，且可能因 dom 操作时机引发其他 react 渲染问题，故不使用\n    // // 对应 Keeper 处 componentDidUpdate 也注释起来不使用\n    // this.eject(false)\n    _helpers.update(id, {\n      name,\n      getInstance: () => this,\n      ...rest,\n    })\n    // this.inject(false)\n  }\n\n  // 利用 shouldComponentUpdate 提前触发组件更新\n  shouldComponentUpdate(nextProps) {\n    this.update(nextProps)\n\n    return false\n  }\n\n  // 组件卸载时重置 dom 状态，保证 react dom 操作正常进行，并触发 unactivate 生命周期\n  componentWillUnmount() {\n    const { id, _helpers, when: calcWhen = true } = this.props\n    const cache = _helpers.getCache(id)\n    const [when, isScope] = parseWhenResult(run(calcWhen))\n\n    if (!cache) {\n      return\n    }\n\n    this.eject()\n    delete cache.getInstance\n\n    if (!when) {\n      if (isScope) {\n        const needToDrop = [\n          cache,\n          ..._helpers.getScopeIds([id]).map((id) => _helpers.getCache(id)),\n        ]\n\n        needToDrop.forEach((cache) => {\n          cache.willDrop = true\n        })\n        nextTick(() => _helpers.dropScopeByIds([id]))\n      } else {\n        cache.willDrop = true\n        nextTick(() => _helpers.dropById(id))\n      }\n    }\n\n    // 触发 willUnactivate 生命周期\n    run(this, LIFECYCLE_UNACTIVATE)\n  }\n\n  render() {\n    return (\n      <div\n        key=\"keep-alive-placeholder\"\n        nodeKeyIgnore\n        className=\"ka-wrapper\"\n        ref={(node) => {\n          this.placeholder = node\n        }}\n      />\n    )\n  }\n}\n\n// 兼容 SSR 服务端渲染\nfunction SSRKeepAlive({ children }) {\n  return (\n    <div key=\"keep-alive-placeholder\" nodeKeyIgnore className=\"ka-wrapper\">\n      <div key=\"keeper-container\" nodeKeyIgnore className=\"ka-content\">\n        {children}\n      </div>\n    </div>\n  )\n}\n\nexport default isFunction(get(root, 'document.getElementById'))\n  ? expandKeepAlive(withActivation(KeepAlive))\n  : SSRKeepAlive\n"],"names":["isRegExp","val","RegExp","aliveScopeContext","createContext","AliveScopeProvider","Provider","AliveScopeConsumer","Consumer","aliveNodeContext","AliveNodeProvider","AliveNodeConsumer","fixedContext","updateListenerCache","Map","fixContext","ctx","push","createReactContext","ProviderBridge","props","args","ctxValues","value","length","state","ctxValue","onUpdate","unmount","setState","children","restValues","nextChildren","React","PureComponent","ConsumerWrapper","id","updateListener","get","ctxInfo","updator","set","undefined","prevValue","shouldUpdate","fn","renderWrapper","renderContent","ctx$$","RecursiveConsumerBridge","renderChildren","reduce","render","HooksConsumerBridge","context$$","map","useContext","prevValueRef","useRef","current","useEffect","filter","ConsumerBridge","every","isSupported","lazy","Suspense","SusNotSupported","Lazy","Promise","FallbackListener","Component","SuspenseBridge","sus$$","onSuspenseStart","onSuspenseEnd","LazyBridge","suspense","Fragment","ErrorBoundaryBridge","error","throwError","error$$","ErrorThrower","cb","Bridge","bridgeProps","Acceptor","LIFECYCLE_ACTIVATE","LIFECYCLE_UNACTIVATE","withActivation","WrappedComponent","HOC","drop","forwardedRef","attach","ref","lifecycleName","prototype","componentDidMount","_componentDidMount","call","forwardRef","ForwardedRefHOC","hoistStatics","useActivation","funcName","func","some","useActivate","bind","useUnactivate","Keeper","rest","listeners","isKeepAlive","store","cache","aliveNodesId","Set","key","Math","random","node","wrapper","has","inited","cached","nodes","keepers","forEach","appendChild","listener","reverse","contextValue","cloneElement","HANDLE_TYPE_DROP","HANDLE_TYPE_REFRESH","AliveScope","params","resolve","keeper","isNew","now","Date","createTime","updateTime","helpers","forceUpdate","update","then","name","getCachingNodes","test","ids","getCachingNodesId","getCache","size","handleNodes","getScopeIds","getCachingNodesByName","dropScopeByIds","refreshScopeByIds","nodesId","type","willRefreshKeepers","willDropNodes","canRefresh","canDrop","willDrop","all","refresh","dropSuccessfully","refreshSuccessfully","Boolean","values","keep","dropScope","dropById","refreshScope","refreshById","clear","getNode","display","controllerCherryPick","controller","expandKeepAlive","KeepAlive","idPrefix","isOutsideAliveScope","console","_nk","HookExpand","WithExpand","withAliveScope","HookScope","WithScope","HOCWithAliveScope","useAliveController","isScrollableNode","scrollWidth","clientWidth","scrollHeight","clientHeight","getScrollableNodes","from","saveScrollPosition","saver","x","scrollLeft","y","scrollTop","revert","body","screenScrollingElement","getErrorTips","parseWhenResult","res","updateTimes","needForceStopUpdate","errorTips","releaseUpdateTimes","didActivate","_helpers","placeholder","revertScrollPos","willUnactivate","nodesNeedToSaveScrollPosition","flag","removeChild","getInstance","inject","init","nextProps","when","calcWhen","isScope","eject","needToDrop","SSRKeepAlive"],"mappings":"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"}